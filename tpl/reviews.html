

<div id="reviews_body" class="main-wrapper">
	<section class="page-title bg-2">
	  <div class="container">
		<div class="row">
		  <div class="col-lg-12 text-center">
			  <ul class="list-inline mb-0">
				<li class="list-inline-item"><a href="index.html" class="text-sm letter-spacing text-white text-uppercase font-weight-bold">Home</a></li>
			  </ul>
			   <h1 class="text-lg text-white mt-2">User Reviews</h1>
		  </div>
		</div>
	  </div>
	</section>


	<section style="padding: 100px 0;">
		<div class="add_review_btn" style="margin-left: 50px;">
			<button id="add_review_btn" type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Add Review</button>
		</div>

		<div class="modal fade" id="myModal" role="dialog">
			<div class="modal-dialog">
			  <!-- Modal content-->
			  <div class="modal-content" id="myModal">
		
			  <form id="add_review_form" action="#">
				<div class="modal-header">
				  <button type="button" class="close" data-dismiss="modal">&times;</button>
				  <h4 class="modal-title"></h4>
				</div>
				<div class="modal-body">
					<div>
					  <label for="name">Name</label>
					  <input type="text" id="name" name="name" class="form-control"></input>
					</div>
					<div>
					  <label for="comment">Comment</label>
					  <input type="text" id="comment" name="comment" class="form-control"></input>
					</div>
				  </div>
				  <div class="error"><span></span></div>
				<div class="modal-footer">
				  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				  <button type="submit" class="btn btn-success">Submit</button>
				</div>
			  </form>
			  </div>
			  </div>
			</div>

			<!-- Edit Modal -->
  <div class="modal fade" id="editModal" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content" id="editModal">

      <form id="edit_form" >
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title"></h4>
        </div>
        <div class="modal-body">
          <input type="text" id="id" name="id" class="form-control" hidden></input>
		  <div>
			<label for="name">Name</label>
			<input type="text" id="name" name="name" class="form-control"></input>
		  </div>
		  <div>
			<label for="comment">Comment</label>
			<input type="text" id="comment" name="comment" class="form-control"></input>
		  </div>
          </div>
          <div class="error"><span></span></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" id="close_button" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-success">Submit</button>
        </div>
      </form>
      </div>
      </div>
    </div>

		<div class="container">
			<div class="row">
				<div class="col-sm">
					<div class="text-center p-5 shadow">
						<table class="table">
							<thead>
							  <tr>
								<th scope="col">Name</th>
								<th scope="col">Comment</th>
								<th scope="col">Delete</th>
								<th scope="col">Edit</th>
							  </tr>
							</thead>
							<tbody id="reviews_content">
	
							</tbody>
						  </table>				
					</div>
				</div>
			</div>
			
		</div>
	</section>
	
	
	<!-- footer Start -->
	<footer class="footer bg-black-50">
		<div class="container">
			<div class="row">
				<div class="col-lg-4 col-md-6 mb-5 mb-lg-0">
					<h2 class="text-white mb-4">GymFit</h2>
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Voluptatibus illo ad quo sunt maiores, sint nostrum omnis eaque cumque dolorum.</p>
	
					<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit.</p>
				</div>
				
	
				<div class="col-lg-3 col-md-6 mb-5 mb-lg-0">
					<div class="footer-widget recent-blog">
						<h4 class="mb-4 text-white letter-spacing text-uppercase">Recents Posts</h4>
						<div>
							<a href="blog-single.html"class="text-white">Claritas est etiam processus dynamicus</a>
							<p class="text-sm mt-2 text-white-50">30 february 2019</p>
						</div>
						<div class="mt-4">
							<a href="blog-single.html"class="text-white">Claritas est etiam processus dynamicus</a>
							<p class="text-sm mt-2 text-white-50">30 february 2019</p>
						</div>
	
					</div>
				</div>
				<div class="col-lg-2 col-md-5 mb-5 mb-lg-0">
					<div class="footer-widget">
						<h4 class="mb-4 text-white letter-spacing text-uppercase">Quick Links</h4>
						<ul class="list-unstyled footer-menu lh-40 mb-0">
							<li><a href="about.html"><i class="ti-angle-double-right mr-2"></i>About Us</a></li>
							<li><a href="service.html"><i class="ti-angle-double-right mr-2"></i>Services</a></li>
							<li><a href="pricing.html"><i class="ti-angle-double-right mr-2"></i>Membership</a></li>
							<li><a href="course.html"><i class="ti-angle-double-right mr-2"></i>Courses</a></li>
							<li><a href="contact.html"><i class="ti-angle-double-right mr-2"></i>Contact us</a></li>
						</ul>
					</div>
				</div>
				<div class="col-lg-3 col-md-5">
					<div class="footer-widget">
						<h4 class="mb-4 text-white letter-spacing text-uppercase">Home location</h4>
						<p>Washington 6036 Richmond
						hwy., Alexandria, VA USA 22303 </p>
						<span class="text-white">+1 (409) 987–5874</span>
						<span class="text-white">info@demolink.org</span>
					</div>
				</div>
			</div>
	
			<div class="row align-items-center mt-5 px-3 bg-black mx-1">
				<div class="col-lg-4">
					<p class="text-white mt-3">Gymfit © 2019 , Theme By <a href="https://themefisher.com/" class="text-color">Themefisher.com</a></p>
				</div>
				<div class="col-lg-6 ml-auto text-right">
					<ul class="list-inline mb-0 footer-socials">
						<li class="list-inline-item"><a href="https://www.facebook.com/themefisher"><i class="ti-facebook"></i></a></li>
						<li class="list-inline-item"><a href="https://twitter.com/themefisher"><i class="ti-twitter"></i></a></li>
						<li class="list-inline-item"><a href="https://github.com/themefisher/"><i class="ti-github"></i></a></li>
					</ul>
				</div>
			</div>
		</div>
	</footer>
	   </div>
	
	<!-- SCRIPT PART -->
	   <script type="text/javascript">

	//    get reviews function from database
	function getReviews(){
  $.ajax({
     url: "rest/reviews",
     type: "GET",
     beforeSend: function(xhr){
       xhr.setRequestHeader('authorization', 'Bearer ' +  localStorage.getItem("user_token"));
     },
     success: function(data) {
       var html = '';
	   var reviews_html = '';
      for(var i = 0; i < data.length; i++){
        reviews_html += '<tr> <td>' + data[i].name + ":" + '</td>';
		reviews_html += '<td>' + data[i].comment + '</td>';
		reviews_html += '<td><button type="button" id="delete_review_btn" class="btn btn-danger" onclick="delete_review('+data[i].id+');">Delete</button></td>';
		reviews_html += '<td><button type="button" id="edit_review_btn" class="btn btn-info"  onclick="open_edit_modal('+data[i].id+');">Edit</button></td> </tr>';
      }
      $("#reviews_content").html(reviews_html);
     },
     error: function(data){  
       toastr.error(data.responseText);
     }
    }); }



// 	   function getReviews(){
//     $.get( "rest/reviews", function( data ) {
     
//     });
//   }
  
  getReviews();

  //  delete review function
  function delete_review(id){
    $.ajax({
        url: 'rest/review/'+id,
        method: 'DELETE',
        success: function(result) {
			getReviews();
            toastr.success('Deleted');
            
        },
        error: function(){
          toastr.error('Not deleted');
        }
    });
  }



// function delete_review(id){
// $.post('rest/review/delete', {id: id}).done(function(){ 
//       toastr.success('review status updated');
//       getReviews();
//     }).fail(function(){
//        toastr.error('review status update failed');
//     });
// }

  function get_review(id){
	  $.get('rest/review?id=' + id, function(data){
	  });
  }

  function open_edit_modal(id){
	  $('#editModal').modal('toggle');
	  $.get('rest/review?id=' + id, function(data){
		  $("#edit_form input[name=id]").val(data.id);
		  $("#edit_form input[name=name]").val(data.name);
		  $("#edit_form input[name=comment]").val(data.comment);
	});
  }


//    add a review form validation
   $("#add_review_form").validate({
   focusCleanup: true,
   errorElement: "em",
  rules: {
    name: 'required',
    comment: 'required',
  },
  messages: {
    name: 'This field is required',
    comment: 'This field is required',
  },
  highlight: function(element, errorClass) {
    $(element).fadeOut(function() {
      $(element).fadeIn();
    });
  },
  errorContainer: "#messageBox1, #messageBox2",
  errorLabelContainer: "#messageBox1 ul",
  wrapper: "li",
  submitHandler: function(form, validator) {
     $.post('rest/reviews', $("#add_review_form").serialize()).done(function(){
       toastr.success('Your Review has been added, Thank you for you feedback'); 
	   $('#myModal').modal('toggle');
	   getReviews();
     }).fail(function(){
        toastr.error('Review not added, please retry again');
     });
  },
  invalidHandler: function(event, validator) {
    var errors = validator.numberOfInvalids();
    toastr.error("Error");
    if (errors) {
      var message = errors == 1
        ? 'You missed 1 field.'
        : 'You missed ' + errors + ' fields.';
      $("div.error span").html(message);
      $("div.error").show();
    } else {
      $("div.error").hide();
    }
   }
  });

// edit a review form validation
$("#edit_form").validate({
   focusCleanup: true,
   errorElement: "em",
  rules: {
    name: 'required',
    comment: 'required',
  },
  messages: {
    name: 'This field is required',
    comment: 'This field is required',
  },
  highlight: function(element, errorClass) {
    $(element).fadeOut(function() {
      $(element).fadeIn();
    });
  },
  errorContainer: "#messageBox1, #messageBox2",
  errorLabelContainer: "#messageBox1 ul",
  wrapper: "li",
  submitHandler: function(form, validator) {
     $.post('rest/review', $("#edit_form").serialize()).done(function(){
       toastr.success('Review updated');
       $('#editModal').modal('toggle');
       getReviews();
     }).fail(function(){
        toastr.error('Review is not updated');
     });
  },
  invalidHandler: function(event, validator) {
    var errors = validator.numberOfInvalids();
    toastr.error("Error");
    if (errors) {
      var message = errors == 1
        ? 'You missed 1 field.'
        : 'You missed ' + errors + ' fields.';
      $("div.error span").html(message);
      $("div.error").show();
    } else {
      $("div.error").hide();
    }
   }
  });



   </script>